* 分区：把一张表的数据分成多个区块，在逻辑上看最终只是一张表，但底层是由多个物理区块组成的
* 分表：把一张表按一定的规则分解成多个具有独立存储空间的实体表。系统读写时需要根据定义好的规则得到对应的字表明，然后操作它。
* 分库：把一个库拆成多个库，突破库级别的数据库操作I/O瓶颈。
----
# MYSQL 分区

一般情况下我们创建的表对应一组存储文件
* 使用MyISAM存储引擎时是一个.MYI和.MYD文件，
* 使用Innodb存储引擎时是一个.ibd和.frm（表结构）文件，分区的意思是指将同一表中不同行的记录分配到不同的物理文件中，几个分区就有几个.idb文件

分区类型及操作

* RANGE分区：基于属于一个给定连续区间的列值，把多行分配给分区。
  * mysql将会根据指定的拆分策略，,把数据放在不同的表文件上。
  * 相当于在文件上,被拆成了小块.但是,对外给客户的感觉还是一张表，透明的
  * 就是每个库一段连续的数据，这个一般是按比如时间范围来的，比如交易表啊，销售表啊等，可以根据年月来存放数据

* LIST分区：按照KEY进行分区类似于按照HASH分区，类似于按RANGE分区，每个分区必须明确定义。
   * 它们的主要区别在于，LIST分区是基于枚举出的值列表分区，而RANGE分区是从属于一个连续区间值的集合

* HASH分区：HASH分区使用的用户定义的表达式，而KEY分区的哈希函数是由MySQL 服务器提供 
    * 好处在于说，可以平均分配每个库的数据量和请求压力；
    * 坏处在于说扩容起来比较麻烦，会有一个数据迁移的过程，之前的数据需要重新计算 hash 值重新分配到不同的库或表

* KEY分区：类似于按HASH分区，区别在于KEY分区只支持计算一列或多列，且MySQL服务器提供其自身的哈希函数。必须有一列或多列包含整数值

----
# 分表
> 分表顾名思义，就是把一张超大的数据表，拆分为多个较小的表

分表和分区的区别
* 分区只是一张表中的数据和索引的存储位置发生改变，分表则是将一张表分成多张表，是真实的有多套表的配套文
* 分区没法突破数据库层面，不论怎么分区，这些分区都要在一个数据库下。而分表可以将子表分配在同一个库中，也可以分配在不同库中，突破数据库性能的限制
* 分区只能替代水平分表的功能，无法取代垂直分表的功能

分表的类型
1. 水平分表:分区就是水平分表的数据库实现版本，它们分的都是行记录
2. 垂直分表:分的是列字段
----
# 分库
> 主要目的是为突破单节点数据库服务器的I/O能力限制，解决数据库水平扩展性问题

解决的问题
* 服务器层次：分区和分表可以把单表分到不同的硬盘上，但不能分配到不同服务器上。一台机器的性能是有限制的，用分库可以解决单台服务器性能不够，或者成本过高问题。
* 将一个库分成多个库，并在多个服务器上部署，就可以突破单服务器的性能瓶颈

分库的类型
1. 水平分库：水平分库就是将单个库中的表作水平分表，然后将子表分别置于不同的子库当中，独立部署
2. 垂直分库：垂直分表拆分的是字段，而垂直分库，拆分的是表
  * 垂直分库是将一个库下的表作不同维度的分类，然后将其分配给不同子库的策略


分库分表存在的问题
> 事务问题

> 跨库跨表的join问题。难以避免会将原本逻辑关联性很强的数据划分到不同的表、不同的库上，这时，表的关联操作将受到限制，我们无法join位于不同分库的表，也无法join分表粒度不同的表，结果原本一次查询能够完成的业务，可能需要多次查询才能完成
```
解决方法：tddl、MyCAT等都支持跨分片join。但是我们应该尽力避免跨库join，如果一定要整合数据，那么请在代码中多次查询完成
```

> 说说分库与分表的设计

MySQL分表有两种分割方式，一种垂直拆分，另一种水平拆分。
* 垂直拆分:通常是按照业务功能的使用频次，把主要的、热门的字段放在一起做为主要表。然后把不常用的，按照各自的业务属性进行聚集，拆分到不同的次要表中；主要表和次要表的关系一般都是一对一的
* 水平拆分(数据分片) 单表的容量不超过500W，否则建议水平拆分。是把一个表复制成同样表结构的不同表，然后把数据按照一定的规则划分，分别存储到这些表中，从而保证单表的容量不会太大，提升性能；当然这些结构一样的表，可以放在一个或多个数据库中。 水平分割的几种方法：

MySQL分库
> 数据库集群环境后都是多台 slave，基本满足了读取操作; 但是写入或者说大数据、频繁的写入操作对master性能影响就比较大，这个时候，单库并不能解决大规模并发写入的问题，所以就会考虑分库。

一个库里表太多了，导致了海量数据，系统性能下降，把原本存储于一个库的表拆分存储到多个库上，通常是将表按照功能模块、关系密切程度划分出来，部署到不同库上
* 减少增量数据写入时的锁对查询的影响
* 由于单表数量下降，常见的查询操作由于减少了需要扫描的记录，使得单表单次查询所需的检索行数变少，减少了磁盘IO，时延变短
---
# 主从复制

复制的基本原理
* slave 会从 master 读取 binlog 来进行数据同步
* master将改变记录到二进制日志（binary log）。这些记录过程叫做二进制日志事件，binary log events；
* slave 将 master 的 binary log events 拷贝到它的中继日志（relay log）;
* slave 重做中继日志中的事件，将改变应用到自己的数据库中。MySQL 复制是异步且是串行化的。


复制的基本原则
* 每个 slave只有一个 master
* 每个 salve只能有一个唯一的服务器 ID
* 每个master可以有多个salve
